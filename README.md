Traffic Light Controller â€“ VHDL Implementation and Testbench

This document describes a complete VHDL solution for a traffic light controller and its automated testbench. It explains the problem briefly and focuses mainly on the implemented solution, how it works, and how to verify it.

Overview

The project contains two VHDL modules: a traffic light controller and its testbench. The controller uses a finite state machine to move between Red, Green, and Yellow lights. State transitions depend on a slower internal pulse generated from the main clock. The testbench automatically verifies the timing, state transitions, reset behavior, and clock enable behavior using assertions.

Problem Description

The goal is to design a traffic light controller where each light stays active for a defined number of timing pulses. The pulses are generated by dividing the main clock. Requirements include:

Red should stay active for 10 pulses.

Green should stay active for 10 pulses.

Yellow should stay active for 5 pulses.

When clkEn is disabled, the controller must pause without changing state.

When reset is active, the controller must immediately return to the Red state.

A self-checking testbench must verify all behavior automatically.

Solution Description

The solution is based on three main parts:

Finite State Machine

The FSM has states RED, GREEN, and YELLOW. It advances on rising edges of a slower derived pulse called second_pulse. Each state maintains an internal counter to determine when to transition. Counters reset automatically when states change. Reset forces the FSM back to RED and clears counters.

Clock Divider

The design includes a small divider that takes the main clock and produces second_pulse every three clock cycles. This pulse is used as the event that updates the FSM. The clock divider works only when clkEn is high. When clkEn is low, the divider holds its state and no pulses are produced.

Testbench with Assertions

The testbench performs the following tasks:

Generates a stable clock.

Applies initial reset and later tests reset again mid-simulation.

Drives clkEn on and off to verify that the FSM freezes correctly.

Tracks timing by waiting for the exact pulse_period.

Uses assertions to check:

Initial state is Red.

Each state lasts the correct number of pulses.

State transitions are correct.

State stays constant when clkEn is disabled.

Prints progress and final success message.

The testbench is fully automated and stops the simulation when all checks pass.

File Structure

The complete project contains:

TrafficLight.vhd (FSM, clock divider, output logic)

tb_TrafficLight.vhd (self-checking testbench)

Simulation Instructions

To run the simulation:

Compile both source files:
vcom TrafficLight.vhd
vcom tb_TrafficLight.vhd

Run the testbench:
vsim tb_TrafficLight

Start the simulation:
run 4000 ns

Review the console output. A success message confirms all assertions passed.

Expected Behavior

During simulation:

After reset, the controller starts at Red.

Red lasts 10 pulses, then transitions to Green.

Green lasts 10 pulses, then transitions to Yellow.

Yellow lasts 5 pulses, then transitions back to Red.

When clkEn goes low, the FSM holds its output and counter unchanged.

Reset at any time forces the controller back to Red immediately.

The testbench prints detailed information and ultimately confirms correct behavior.

